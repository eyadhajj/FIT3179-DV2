<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FIT3179 - Eyad El Hajj - DV2</title>

  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background:#fafafa; }
    nav {
      background:#333; color:white; padding:15px 0; margin-bottom:20px;
    }
    nav h1, nav h2 { margin:0; }
    main { max-width:1700px; }
    .vis-wrap input[type=range]::-webkit-slider-thumb {
      background-color:#007bff;
    }
    .vega-embed { background:white; border-radius:8px; padding:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    p.center { text-align: justify; padding: 0 15px; }
  </style>
</head>

<body>
  <nav class="text-center">
    <h1>Heart Disease Data Visualisation</h1>
    <h2>Eyad El Hajj - 33180830 - Lab03 - Karan R.</h2>
  </nav>

  <br class="container mb-5">
    <div class="vis-wrap mb-4 text-center">
      <label for="yearSlider" class="form-label fw-bold">
        Year: <span id="yearVal">2019</span>
      </label>
      <input id="yearSlider" type="range" min="1990" max="2019" step="1" value="2019"
             class="form-range w-50 mx-auto" />
    </div>
<div class="row g-4 mt-4">
  <div class="col-12 text-center">
    <div id="vis-map" style="display:inline-block;"></div>
  </div>
</div>

    <p class="card mx-auto text-center mt-4 p-3 shadow-sm" style="width: 60rem;">
      The dataset contains multiple causes of deaths including Meningitis, Alzheimer’s Disease and Other Dementias,
      Parkinson’s Disease, Nutritional Deficiencies, Malaria, Drowning, Interpersonal Violence, Maternal Disorders,
      HIV/AIDS, Drug Use Disorders, Tuberculosis, Cardiovascular Diseases, Lower Respiratory Infections, Neonatal
      Disorders, Alcohol Use Disorders, Self-harm, Exposure to Forces of Nature, Diarrheal Diseases, Environmental
      Heat and Cold Exposure, Neoplasms, Conflict and Terrorism, Diabetes Mellitus, Chronic Kidney Disease, Poisonings,
      Protein-Energy Malnutrition, Road Injuries, Chronic Respiratory Diseases, Cirrhosis and Other Chronic Liver
      Diseases, Digestive Diseases, Fire, Heat, and Hot Substances, and Acute Hepatitis.
    </p>

    <div class="row g-4 mt-4">
      <div class="col-12 text-center">
        <div id="vis-causes" style="display:inline-block;"></div>
      </div>
    </div>
  </br>
    <p class="card mx-auto text-center mt-4 p-3 shadow-sm" style="width: 60rem;"> Clearly, it is show that in this dataset, the leading causes of death around the world (according to this dataset) is due to Cardiovascular diseases.</p>

  </main>


    <!-- Grid 2: Trend + Scatter -->
    <div class="row g-4 mt-4" style="margin-left: 40px; ">
            <div class="col-md-6">
        <div id="vis-top10"></div>
      </div>
      <div class="col-md-6"><div id="vis-trend"></div></div>
      <div class="col-md-6" style="margin-right: 60px;"><div id="vis-scatter"></div></div>
    </div>



  <script>
  /* ---------------- MAP ---------------- */
  const specMap = {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 999, "height": 400,
    "projection": {"type": "equirectangular"},
    "params": [{"name": "YearParam", "value": 2019}],
    "layer": [
      {
        "data": {"url": "https://cdn.jsdelivr.net/npm/world-atlas@2/land-110m.json",
                 "format": {"type": "topojson","feature": "land"}},
        "mark": {"type":"geoshape","fill":"#eeeeee"}
      },
      {
        "data": {"url": "https://raw.githubusercontent.com/eyadhajj/FIT3179-DV2/refs/heads/main/cause_of_deaths_total.csv",
                 "format": {"type": "csv"}},
        "transform": [
          {"filter": "datum.Year == YearParam && isValid(datum.TotalDeaths)"},
          {"calculate": "datum['Country/Territory']", "as": "country_mapped"},
          {"lookup": "country_mapped",
           "from": {"data": {"url": "https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json",
                             "format": {"type": "topojson","feature":"countries"}},
                    "key": "properties.name"},
           "as": "geo"}
        ],
        "mark": {"type": "geoshape","stroke":"black"},
        "encoding": {
          "shape": {"field":"geo","type":"geojson"},
          "color": {"field":"TotalDeaths","type":"quantitative","scale":{"scheme":"reds"},
                    "legend":{"title":"Total deaths (count)"}},
          "tooltip":[
            {"field":"Country/Territory","title":"Country"},
            {"field":"Year","title":"Year"},
            {"field":"TotalDeaths","type":"quantitative","format":",.0f"}
          ]
        }
      }
    ]
  };

  /* ---------------- TOP10 ---------------- */
  const specTop10 = {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 400,"height":400,
    "params":[{"name":"YearParam","value":2019}],
    "data":{
      "url":"https://raw.githubusercontent.com/eyadhajj/FIT3179-Week-10-Homework-Task/main/cause_of_deaths_total.csv",
      "format":{"type":"csv"}
    },
    "transform":[
      {"filter":"toNumber(datum.Year)==YearParam && isValid(datum.TotalDeaths)"},
      {"aggregate":[{"op":"sum","field":"TotalDeaths","as":"TotalDeaths"}],
       "groupby":["Country/Territory"]},
      {"window":[{"op":"rank","as":"rk"}],
       "sort":[{"field":"TotalDeaths","order":"descending"}]},
      {"filter":"datum.rk<=10"}
    ],
    "mark":"bar",
    "encoding":{
      "y":{"field":"Country/Territory","type":"nominal","sort":"-x","title":"Country"},
      "x":{"field":"TotalDeaths","type":"quantitative","title":"Total deaths (count)"},
      "color":{"field":"TotalDeaths","type":"quantitative","scale":{"scheme":"reds"}},
      "tooltip":[
        {"field":"Country/Territory","title":"Country"},
        {"field":"TotalDeaths","type":"quantitative","format":",.0f"},
        {"field":"Year","title":"Year"}
      ]
    },
    "title":{"text":"Top 10 Countries by Total Deaths","anchor":"start","fontSize":16}
  };

  /* ---------------- TREND ---------------- */
  const specTrend = {
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "width":430,"height":350,
    "data":{
      "url":"https://raw.githubusercontent.com/eyadhajj/FIT3179-Week-10-Homework-Task/main/cause_of_deaths_total.csv",
      "format":{"type":"csv"}
    },
    "transform":[{"aggregate":[{"op":"sum","field":"TotalDeaths","as":"GlobalTotalDeaths"}],"groupby":["Year"]}],
    "mark":{"type":"line","color":"#d73027","point":{"filled":true,"color":"#d73027"}},
    "encoding":{
      "x":{"field":"Year","type":"ordinal","title":"Year"},
      "y":{"field":"GlobalTotalDeaths","type":"quantitative","title":"Total Global Deaths"},
      "tooltip":[{"field":"Year","title":"Year"},{"field":"GlobalTotalDeaths","type":"quantitative","format":",.0f"}]
    },
    "title":{"text":"Global Total Deaths Due to Heart Disease","anchor":"start","fontSize":16}
  };

  /* ---------------- SCATTER ---------------- */
  const specScatter = {
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "width":800,"height":350,
    "params":[{"name":"YearParam","value":2019}],
    "data":{
      "url":"https://raw.githubusercontent.com/eyadhajj/FIT3179-Week-10-Homework-Task/main/cause_of_deaths_total.csv",
      "format":{"type":"csv"}
    },
    "transform":[
      {"filter":"toNumber(datum.Year)==YearParam && isValid(datum.TotalDeaths)"},
      {"aggregate":[{"op":"sum","field":"TotalDeaths","as":"TotalDeaths"}],"groupby":["Country/Territory","Year"]},
      {"window":[{"op":"rank","as":"rk"}],"sort":[{"field":"TotalDeaths","order":"descending"}]},
      {"filter":"datum.rk<=15"}
    ],
    "mark":{"type":"circle","opacity":0.8,"stroke":"black","strokeWidth":0.4},
    "encoding":{
      "x":{"field":"TotalDeaths","type":"quantitative","title":"Total Deaths"},
      "y":{"field":"Country/Territory","type":"nominal","sort":"-x","title":"Country"},
      "color":{"field":"TotalDeaths","type":"quantitative","scale":{"scheme":"reds"},"legend":null},
      "size":{"field":"TotalDeaths","type":"quantitative","scale":{"range":[50,1200]},"legend":null},
      "tooltip":[
        {"field":"Country/Territory","title":"Country"},
        {"field":"TotalDeaths","type":"quantitative","format":",.0f","title":"Total Deaths"},
        {"field":"Year","title":"Year"}
      ]
    },
    "title":{"text":"Top 15 Countries – Deaths","anchor":"start","fontSize":16}
  };

  /* ---------------- Top 10 Causes ---------------- */
  const specCauses = {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 700,
    "height": 300,
    "data": {
      "url": "https://raw.githubusercontent.com/eyadhajj/FIT3179-Week-10-Homework-Task/main/cause_of_deaths_total.csv",
      "format": {"type": "csv"}
    },
    "transform": [
      {
        "fold": [
          "Meningitis",
          "Alzheimers Disease and Other Dementias",
          "Parkinsons Disease",
          "Nutritional Deficiencies",
          "Malaria",
          "Drowning",
          "Interpersonal Violence",
          "Maternal Disorders",
          "HIV/AIDS",
          "Drug Use Disorders",
          "Tuberculosis",
          "Cardiovascular Diseases",
          "Lower Respiratory Infections",
          "Neonatal Disorders",
          "Alcohol Use Disorders",
          "Self-harm",
          "Exposure to Forces of Nature",
          "Diarrheal Diseases",
          "Environmental Heat and Cold Exposure",
          "Neoplasms",
          "Conflict and Terrorism",
          "Diabetes Mellitus",
          "Chronic Kidney Disease",
          "Poisonings",
          "Protein-Energy Malnutrition",
          "Road Injuries",
          "Chronic Respiratory Diseases",
          "Cirrhosis",
          "Digestive Diseases",
          "Fire, Heat, and Hot Substances",
          "Acute Hepatitis"
        ],
        "as": ["Cause", "Deaths"]
      },
      {"aggregate": [{"op": "sum", "field": "Deaths", "as": "TotalDeaths"}], "groupby": ["Cause"]},
      {"window": [{"op": "rank", "as": "Rank"}], "sort": [{"field": "TotalDeaths", "order": "descending"}]},
      {"filter": "datum.Rank <= 10"}
    ],
    "mark": "bar",
    "encoding": {
      "x": {"field": "TotalDeaths", "type": "quantitative", "title": "Total Deaths"},
      "y": {"field": "Cause", "type": "nominal", "sort": "-x", "title": "Cause of Death"},
      "color": {"field": "Cause", "type": "nominal", "legend": null},
      "tooltip": [
        {"field": "Cause", "title": "Cause"},
        {"field": "TotalDeaths", "type": "quantitative", "format": ",.0f"},
        {"field": "Rank", "type": "quantitative"}
      ]
    },
    "title": {"text": "Top 10 Causes of Death (All Years, Global Total)", "anchor": "start", "fontSize": 16}
  };

  /* ---------------- EMBED ---------------- */
  let viewMap, viewTop10, viewScatter;
  vegaEmbed('#vis-map', specMap, {actions:false}).then(r => viewMap = r.view);
  vegaEmbed('#vis-top10', specTop10, {actions:false}).then(r => viewTop10 = r.view);
  vegaEmbed('#vis-trend', specTrend, {actions:false});
  vegaEmbed('#vis-scatter', specScatter, {actions:false}).then(r => viewScatter = r.view);
  vegaEmbed('#vis-causes', specCauses, {actions:false});

  /* ---------------- SLIDER ---------------- */
  const slider = document.getElementById('yearSlider');
  const yearVal = document.getElementById('yearVal');
  slider.addEventListener('input', () => {
    yearVal.textContent = slider.value;
    if(viewMap) viewMap.signal('YearParam', +slider.value).run();
    if(viewTop10) viewTop10.signal('YearParam', +slider.value).run();
    if(viewScatter) viewScatter.signal('YearParam', +slider.value).run();
  });
  </script>
</body>
</html>
